@model ClientWorkoutViewModel
@Html.AntiForgeryToken()


@{
    ViewData["Title"] = "My Programs | Personal Trainer Software for Professionals";
    Layout = null;
}

@using Microsoft.AspNetCore.Identity
@using EzyShape.Infrastructure.Data.Models

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EzyShape | Personal Trainer Software for Professionals</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="~/css/normalize.css">
    <link rel="stylesheet" href="~/css/Client/allWorkouts.css">
    <link rel="stylesheet" href="~/css/Client/bottomNavigation.css">
    <link rel="stylesheet" href="~/css/Client/workoutModal.css">
</head>
<body>

    <!-- Header -->
    <header class="app-header">
        <p>Training</p>
        <div class="sub-nav-div">

            <button class="suv-nav-button sub-active">
                <i class="fa-solid fa-dumbbell"></i>
                Programs
            </button>

            <button class="suv-nav-button">
                <i class="fa fa-history" aria-hidden="true"></i>
                History
            </button>

        </div>
    </header>

    <main>
        <div class="programs-div div-active">

            @foreach (var split in Model.Splits)
            {
                <div class="split-container container" data-id="@split.Id   ">
                    <div class="container-texts-div">
                        <div class="workout-name-div">
                            <p class="workout-name-text">
                                @split.Name
                            </p>
                        </div>
                        <div class="workout-info-div">
                            <i class="fa-solid fa-circle-info"></i>
                        </div>
                    </div>
                </div>
            }
        </div>


        <div class="history-div">
            History
        </div>

    </main>


    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a asp-area="Client" asp-controller="Client" asp-action="Index" class="nav-item">
            <i class="icon-home">
                <i class="fa-solid fa-house"></i>
            </i>
        </a>
        <a href="#" class="nav-item active"><i class="icon-nutrition"><i class="fa-solid fa-dumbbell"></i></i></a>

        <a href="#" class="nav-item"><i class="icon-water"><i class="fa-solid fa-chart-line"></i></i></a>


        <a asp-area="Client" asp-controller="Client" asp-action="Profile" class="nav-item">
            <i class="icon-settings"></i>
            <i class="fa-solid fa-user"></i>
        </a>


    </nav>

    <!-- Fullscreen Bottom Modal -->
    <div id="workoutModal" class="modal-overlay" data-id="" style="display: none;">
        <div class="modal-slider">
            @for(int i=0;i<5;i++)
            {
                <div class="concrete-workout-container">
                    <button class="close-modal-btn" onclick="closeModal()">×</button>
                    <div class="concrete-workout-top-div">
                        <h3 class="concrete-workout-name-text">
                            Workout @i
                        </h3>
                    </div>
                    <div class="concrete-workout-content-div">
                        <div class="exercises-count-div">
                            <p class="exercises-count-text">X Exercises</p>
                        </div>
                        <div class="exercises-list-div">
                            @for(int j=0;j<8;j++)
                            {
                                <div class="exercise-item-div">
                                    <div class="exercise-img">
                                        <img src="img/ClientArea/workoutBackground.jpg" alt="Alternate Text" style="height:20px; width:20px;"/>
                                    </div>
                                    <p class="exercise-name">
                                        Exercise Name
                                    </p>
                                </div>
                            }
                        </div>
                    </div>
                    <div class="workout-bottom-div">
                        <button class="start-workout-button">
                            Start Workout
                        </button>
                    </div>
                </div>
            }
        </div>
    </div>



    <script src="~/js/toggleTrainingSubNavigation.js" asp-append-version="true"></script>
    <script>
        // Modal functionality
        function openModal(splitId) {
            const modal = document.getElementById('workoutModal');
            modal.style.display = 'block';
            modal.dataset.id = splitId;
            document.body.style.overflow = 'hidden';

            // Initialize slider position
            currentSlide = 0;
            updateSliderPosition();
        }

        function closeModal() {
            const modal = document.getElementById('workoutModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Swipe functionality
        let currentSlide = 0;
        const slideCount = document.querySelectorAll('.concrete-workout-container').length;
        const slider = document.querySelector('.modal-slider');
        let startX = 0;
        let isDragging = false;

        function updateSliderPosition() {
            slider.style.transform = `translateX(-${currentSlide * 100}vw)`;
        }

        function goToSlide(index) {
            if (index >= 0 && index < slideCount) {
                currentSlide = index;
                updateSliderPosition();
            }
        }

        // Touch events for mobile
        slider.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            isDragging = true;
        });

        slider.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            const x = e.touches[0].clientX;
            const diff = startX - x;

            // Prevent vertical scrolling when swiping horizontally
            if (Math.abs(diff) > 5) {
                e.preventDefault();
            }
        });

        slider.addEventListener('touchend', (e) => {
            if (!isDragging) return;

            const endX = e.changedTouches[0].clientX;
            const diff = startX - endX;

            if (diff > 50 && currentSlide < slideCount - 1) {
                // Swipe left - go to next slide
                goToSlide(currentSlide + 1);
            } else if (diff < -50 && currentSlide > 0) {
                // Swipe right - go to previous slide
                goToSlide(currentSlide - 1);
            }

            isDragging = false;
        });

        // Mouse events for desktop
        slider.addEventListener('mousedown', (e) => {
            startX = e.clientX;
            isDragging = true;
        });

        slider.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
        });

        slider.addEventListener('mouseup', (e) => {
            if (!isDragging) return;

            const endX = e.clientX;
            const diff = startX - endX;

            if (diff > 50 && currentSlide < slideCount - 1) {
                // Swipe left - go to next slide
                goToSlide(currentSlide + 1);
            } else if (diff < -50 && currentSlide > 0) {
                // Swipe right - go to previous slide
                goToSlide(currentSlide - 1);
            }

            isDragging = false;
        });

        slider.addEventListener('mouseleave', () => {
            isDragging = false;
        });

        // Add click handlers to open the modal when split containers are clicked
        document.querySelectorAll('.split-container').forEach(container => {
            container.addEventListener('click', () => {
                const splitId = container.dataset.id;
                openModal(splitId);
            });
        });
    </script>

</body>
</html>