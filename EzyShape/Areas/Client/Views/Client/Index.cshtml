@model ClientIndexMenuViewModel
@inject IViewLocalizer Localizer

@{
    ViewData["Title"] = @Localizer["Title"];
    Layout = null;
}

@using Microsoft.AspNetCore.Identity
@using EzyShape.Infrastructure.Data.Models

@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@Localizer["Title"]</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="~/css/normalize.css">
    <link rel="stylesheet" href="~/css/Client/clientHome.css">
    <!-- Toastr CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />

    <!-- Toastr JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

</head>
<body>

    <!-- Header -->
    <header class="app-header">
        <div class="app-header-items">
            <div class="app-logo">
                <img class="logo-img" src="~/img/LogoOnly.png" alt="EzyShape" width="35" height="35">
            </div>
            <div class="app-name">EzyShape</div>
            <div class="app-icons">
                <span class="notification-icon"><i class="fa-regular fa-bell"></i></span>
                <a style="text-decoration: none; color: inherit;" asp-controller="Chat" asp-action="Index">
                    <span class="menu-icon"><i class="fa-regular fa-message"></i></span>
                </a>

            </div>
        </div>


        <!-- Greeting -->
        <section class="greeting-section">
            <p class="greeting-text">@Localizer["Hello"] @Model.Client.FirstName @Model.Client.LastName,</p>
            <p class="greeting-subtext"><em>@Localizer["YourPotentialIsEndless"]</em></p>
        </section>

    </header>

    <!-- Notes Section -->
    <section class="recent-notes box-shadow">
        <div class="notes-header">
            <p><i class="fa-solid fa-note-sticky" style="color:#2081f1"></i> @Localizer["RecentNotes"] (@Model.TrainerNotes.Count())</p>
            <button id="toggleNotesBtn" class="view-all-button">@Localizer["ViewAll"]</button>
        </div>

        @if (!Model.TrainerNotes.Any())
        {
            <p class="notes-message">@Localizer["NoNotesYet"]</p>
        }
        else
        {
            <ul id="notesList">
                @{
                    var count = 0;
                    foreach (var note in Model.TrainerNotes)
                    {
                        var isHidden = count >= 3 ? "hidden-note" : "";
                        <li class="note-title @isHidden" data-id="@note.Id" data-title="@note.Title" data-content="@note.Content">@note.Title</li>
                        ;
                        count++;
                    }
                }
            </ul>
        }
    </section>


    <!-- Modal -->
    <div id="noteModal" class="note-modal">
        <div class="note-modal-content">
            <span class="close-modal">&times;</span>
            <h3 id="modalTitle"></h3>
            <p id="modalContent"></p>
            <button id="archiveBtn" class="finish-button" data-note-id="">@Localizer["Done"]</button>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active"><i class="icon-home"><i class="fa-solid fa-house"></i></i></a>

        <a asp-area="Client" asp-controller="Workout" asp-action="Programs" class="nav-item">
            <i class="icon-nutrition"></i>
            <i class="fa-solid fa-dumbbell"></i>
        </a>




        <a href="#" class="nav-item"><i class="icon-water"><i class="fa-solid fa-chart-line"></i></i></a>

        <a asp-area="Client" asp-controller="Client" asp-action="Profile" class="nav-item">
            <i class="icon-settings"></i>
            <i class="fa-solid fa-user"></i>
        </a>

    </nav>

    <script src="~/js/Client/archieveNote.js"></script>

    <script>
               document.addEventListener("DOMContentLoaded", function () {
            const toggleBtn = document.getElementById("toggleNotesBtn");
            const hiddenNotes = document.querySelectorAll(".hidden-note");
            let isExpanded = false;

            if (!hiddenNotes.length) {
                toggleBtn.style.display = 'none'; // hide button if no hidden notes
                return;
            }

            // Localized strings rendered by Razor
            const showMoreText = '@Localizer["ViewAll"]';
            const showLessText = '@Localizer["ShowLess"]';

            toggleBtn.addEventListener("click", function () {
                isExpanded = !isExpanded;

                hiddenNotes.forEach(note => {
                    note.style.display = isExpanded ? "list-item" : "none";
                });

                toggleBtn.textContent = isExpanded ? showLessText : showMoreText;
            });
        });
    </script>


</body>
</html>